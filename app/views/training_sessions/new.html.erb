<h1>トレーニング記録</h1>

<%= form_with(model: @training_session, local: true, data: { turbo: false }, html: {id: 'training-session-form'}) do |form| %>
  <% if @training_session.errors.any? %>
    <div id="error_explanation">
      <h2>※記録が保存されませんでした</h2>
      <ul>
        <% @training_session.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <%= form.label :date, "日付" %>
    <%= form.date_field :date %>
  </div>

  <h3>エクササイズ</h3>
   <div id="exercises-container">
    <% @training_session.session_exercises.each_with_index do |session_exercise, i| %>
      <div class="exercise-row" data-index="<%= i %>">
        <%= form.label :name, "種目 #{i + 1}" %>
        <%= form.text_field :name, name: "training_session[session_exercises_attributes][#{i}][name]", placeholder: "種目名" %>
        <%= form.label :weight, "重量" %>
        <%= form.number_field :weight, name: "training_session[session_exercises_attributes][#{i}][weight]", placeholder: "重量(kg)" %>
        <%= form.label :reps, "回数" %>
        <%= form.number_field :reps, name: "training_session[session_exercises_attributes][#{i}][reps]", placeholder: "回数" %>
      </div>
    <% end %>
  </div>
  <button type="button" id="add-exercise">エクササイズを追加</button>

  <div class="actions">
    <%= form.submit "保存" %>
  </div>
<% end %>

<%= link_to '戻る', training_sessions_path %>

<script type="text/javascript">
  document.addEventListener('DOMContentLoaded', function() {
    const container = document.getElementById('exercises-container');
    const addButton = document.getElementById('add-exercise');

    addButton.addEventListener('click', function() {
      const newIndex = container.children.length;
      const newRow = document.createElement('div');
      newRow.innerHTML = `
        <label for="exercise">種目 ${newIndex + 1}</label>
        <input type="text" name="training_session[session_exercises_attributes][${newIndex}][name]" placeholder="種目名">
        <label for="weight">重量</label>
        <input type="number" name="training_session[session_exercises_attributes][${newIndex}][weight]" placeholder="重量(kg)">
        <label for="reps">回数</label>
        <input type="number" name="training_session[session_exercises_attributes][${newIndex}][reps]" placeholder="回数">
      `;
      newRow.classList.add('exercise-row');
      newRow.setAttribute('data-index', newIndex);
      container.appendChild(newRow);
    });
  });
</script>